<!DOCTYPE html>
<html>
<style>
body{
    background-image:url('assets/bg.webp');
}
</style>
<body>
    <div id='Smooth' style="z-index: -123;position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;background-color: black; opacity: 1;"></div>
    <script src="Smooth.js"></script>
    <script>

function random_int_(min, max) {//In taptapir but taptap is defined before goodness
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}  

function Playwoosh() {
   if (!allowedAttackSFX) {
    ;
   } else {
    swoosh = random_int_(1,3);
    if (swoosh === 1) {
      woosh = new Audio('assets/woosh1.ogg')
    } else if (swoosh === 2) {
      woosh = new Audio('assets/woosh2.ogg')
    } else {
      woosh = new Audio('assets/woosh3.ogg')
    }
    woosh.volume = parseFloat(window.localStorage.getItem('mastervolume'))
    woosh.play()

    woosh.addEventListener('ended', function() {
      woosh.remove();
    })};
}


StartedSong = new Audio('assets/bgsong.ogg')
StartedSong.play();
StartedSong.loop = true;
window.addEventListener('click', (event) => {
  if (StartedSong.paused) {
    StartedSong.play();
    //alert("Why was the audio paused?")
  }
})

function SetVolumes(volume) {
    StartedSong.volume = volume
}

const savedImageData = localStorage.getItem('customBG');
    if (savedImageData) {
      document.body.style.backgroundImage = `url(${savedImageData})`;    }

function formatNumber(number) {
  const roundedNumber = Math.round(number * 100) / 100;

  if (roundedNumber >= 1000) {
    if (roundedNumber >= 1e12) {
      return (roundedNumber / 1e12).toFixed(2) + 'T';
    } else if (roundedNumber >= 1e9) {
      return (roundedNumber / 1e9).toFixed(2) + 'B';
    } else if (roundedNumber >= 1e6) {
      return (roundedNumber / 1e6).toFixed(2) + 'M';
    } else if (roundedNumber >= 1e3) {
      return (roundedNumber / 1e3).toFixed(2) + 'K';
    } else {
      return roundedNumber.toFixed(2);
    }
  } else {
    return roundedNumber.toString();
  }
}
function PauseSounds() {
    StartedSong.pause()
}
function ResumeSounds() {
    StartedSong.play()
}
    </script>

    <script src="taptapir/taptapir.js"></script>   
<script type="text/sunsnake">

#Global Functions
set_orientation('horizontal')
set_window_color('transparent')
set_background_color('black')
ASSETS_FOLDER = 'assets/'

#Global variables
mainScene = []
shopScene = []

#For settings
save_system_save('prevtab', "main")

#Loading score and data etc.
score = int(save_system_load('score'))
if not score:
    score = 0

volume = parseFloat(save_system_load('mastervolume'))
if not volume:
  volume = 1
  save_system_save('mastervolume', volume)

Gen1Cost = int(save_system_load('gen1cost'))
if not Gen1Cost or Gen1Cost == null:
    Gen1Cost = 15
Gen2Cost = int(save_system_load('gen2cost'))
if not Gen2Cost or Gen2Cost == null:
    Gen2Cost = 100
Gen3Cost = int(save_system_load('gen3cost'))
if not Gen3Cost or Gen3Cost == null:
    Gen3Cost = 1100
Gen4Cost = int(save_system_load('gen4cost'))
if not Gen4Cost or Gen4Cost == null:
    Gen4Cost = 12000

friendMode = save_system_load("friendmodeactive")

SetVolumes(volume);
  
allowedAttackSFX = save_system_load('attacksfx')
if allowedAttackSFX == null:
    allowedAttackSFX = True
    save_system_save('attacksfx', allowedAttackSFX)

#Main clicker game
ClickerDude = Button(texture='Clicker-idle.gif',scale=[.3,.3],y=0)
ClickerDude.on_click = def():
    score += 1
    Playwoosh()


score_display = Text(text=`Clicks: ${score}`,xy=[0.24,-.1],text_size=5)
score_display.update = def():
    Fscore = formatNumber(score);
    score_display.text = `Clicks: ${Fscore}`

cpsDisplay = Text(text='CpS: 0',xy=[0.34,-.85],text_size=4)
cpsDisplay.update = def():
    try:
        Gen1CPS = .1 * Gen1Owned
        Gen2CPS = 1 * Gen2Owned
        Gen3CPS = 8 * Gen3Owned
        Gen4CPS = 47 * Gen4Owned
    
        collectiveCPS = Gen1CPS + Gen2CPS + Gen3CPS + Gen4CPS
        cpsDisplay.text = `CpS: ${formatNumber(collectiveCPS)}`
    catch (Error) {;}

settingsButton = Button(texture='settingsCog.webp',scale=.1,x=.8,y=.45)
settingsButton.on_click = def():
    SmoothTransit("Settings")


#General updating stuff
def update():
    save_system_save('score', score)

inShop = False
ShopButton = Button(texture='shopCog.png',x=.75,scale=.2,y=-.02)
ShopButton.on_click = def():
    if not inShop:
        inShop=True
        for e in mainScene:
            e.enabled=False
        for e in shopScene:
            e.enabled=True
    else:
        inShop = False
        for e in mainScene:
            e.enabled=True
        for e in shopScene:
            e.enabled=False



#Shop stuff & gens very annoying

Gen1 = Button(cost=Gen1Cost,texture='clickerGen1.png',enabled=False,x=-.8,y=.3)
Gen1.on_click = def():
    if score >= Gen1.cost:
        score -= Gen1.cost
        Gen1.cost = 15 * Math.pow(1.15,Gen1Owned+1)
        Gen1.cost = round(Gen1.cost)
        Gen1Owned += 1
        Fcost = formatNumber(Gen1.cost);
        Gen1Info.text = `Cost: ${Fcost}`
        save_system_save("gen1owned", Gen1Owned)
        save_system_save("gen1cost", Gen1.cost)

Gen1Info = Text(x=-.49,y=-.3,text=`Cost: ${Gen1.cost}`,text_size=4.5,enabled=False)

Gen2 = Button(cost=Gen2Cost,texture='clickerGen2.png',enabled=False,x=-.8,y=-.01)
Gen2.on_click = def():
    if score >= Gen2.cost:
        score -= Gen2.cost
        Gen2.cost = 100 * Math.pow(1.15,Gen2Owned+1)
        Gen2.cost = round(Gen2.cost)
        Gen2Owned += 1
        Fcost = formatNumber(Gen2.cost);
        Gen2Info.text = `Cost: ${Fcost}`
        save_system_save("gen2owned", Gen2Owned)
        save_system_save("gen2cost", Gen2.cost)

Gen2Info = Text(x=-.49,y=-.6,text=`Cost: ${Gen2.cost}`,text_size=4.5,enabled=False)

Gen3 = Button(cost=Gen3Cost,texture='clickerGen3.png',enabled=False,x=-.8,y=-.3)
Gen3.on_click = def():
    if score >= Gen3.cost:
        score -= Gen3.cost
        Gen3.cost = 1100 * Math.pow(1.15,Gen3Owned+1)
        Gen3.cost = round(Gen3.cost)
        Gen3Owned += 1
        Fcost = formatNumber(Gen3.cost);
        Gen3Info.text = `Cost: ${Fcost}`
        save_system_save("gen3owned", Gen3Owned)
        save_system_save("gen3cost", Gen3.cost)

FormattedGen3 = formatNumber(Gen3Cost)
Gen3Info = Text(x=-.49,y=-.9,text=`Cost: ${FormattedGen3}`,text_size=4.5,enabled=False)


Gen4 = Button(cost=Gen4Cost,texture='KarltonGen.png',enabled=False,x=-.3,y=.3)
Gen4.on_click = def():
    if score >= Gen4.cost:
        score -= Gen4.cost
        Gen4.cost = 12000 * Math.pow(1.15,Gen4Owned+1)
        Gen4.cost = round(Gen4.cost)
        Gen4Owned += 1
        Fcost = formatNumber(Gen4.cost);
        Gen4Info.text = `Cost: ${Fcost}`
        save_system_save("gen4owned", Gen4Owned)
        save_system_save("gen4cost", Gen4.cost)

FormattedGen4 = formatNumber(Gen4Cost)
Gen4Info = Text(x=-.05,y=-.3,text=`Cost: ${FormattedGen4}`,text_size=4.5,enabled=False)
if friendMode == 'true':
    Gen4.texture = 'KarltonGen.png'





#Appending shop items
shopScene.append(Gen1)
shopScene.append(Gen1Info)
shopScene.append(Gen2)
shopScene.append(Gen2Info)
shopScene.append(Gen3)
shopScene.append(Gen3Info)
shopScene.append(Gen4)
shopScene.append(Gen4Info)

#Appending main items
mainScene.append(ClickerDude)
mainScene.append(score_display)
mainScene.append(settingsButton)
mainScene.append(cpsDisplay)




_hidden_fullscreen_button.xy = [213213213,123123123]
</script>
<script src="taptapir/sunsnake_compiler.js"></script>
<script src="EarnClicks.js"></script>
</body>
</html>